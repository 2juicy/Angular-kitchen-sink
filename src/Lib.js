var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('angular2/core');
var redux_1 = require("redux");
var thunkMiddleware = require('redux-thunk');
var angular2_redux_util_1 = require("angular2-redux-util");
var Lib = (function () {
    function Lib() {
    }
    Lib.StoreFactory = function (reducerList) {
        return function () {
            var reducers = redux_1.combineReducers(reducerList);
            var middlewareEnhancer = redux_1.applyMiddleware(thunkMiddleware);
            var isDebug = window.devToolsExtension;
            var applyDevTools = function () { return isDebug ? window.devToolsExtension() : function (f) { return f; }; };
            var enhancers = redux_1.compose(middlewareEnhancer, applyDevTools());
            var createStoreWithEnhancers = enhancers(redux_1.createStore);
            var reduxAppStore = createStoreWithEnhancers(reducers);
            return new angular2_redux_util_1.AppStore(reduxAppStore);
        };
    };
    Lib.LoadComponentAsync = function (name, path) {
        return System.import(path).then(function (c) { return c[name]; });
    };
    Lib.log = function (msg) {
        console.log(new Date().toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, "$1") + ': ' + msg);
    };
    Lib.guid = function () {
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000)
                .toString(16)
                .substring(1);
        }
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
            s4() + '-' + s4() + s4() + s4();
    };
    Lib.Xml2Json = function () {
        var xmlToJSON = (function () {
            this.version = "1.3";
            var options = {
                mergeCDATA: true,
                grokAttr: true,
                grokText: true,
                normalize: true,
                xmlns: true,
                namespaceKey: '_ns',
                textKey: '_text',
                valueKey: '_value',
                attrKey: '_attr',
                cdataKey: '_cdata',
                attrsAsObject: true,
                stripAttrPrefix: true,
                stripElemPrefix: true,
                childrenAsArray: true
            };
            var prefixMatch = new RegExp('(?!xmlns)^.*:/');
            var trimMatch = new RegExp('^\s+|\s+$g');
            this.grokType = function (sValue) {
                if (/^\s*$/.test(sValue)) {
                    return null;
                }
                if (/^(?:true|false)$/i.test(sValue)) {
                    return sValue.toLowerCase() === "true";
                }
                if (isFinite(sValue)) {
                    return parseFloat(sValue);
                }
                return sValue;
            };
            this.parseString = function (xmlString, opt) {
                return this.parseXML(this.stringToXML(xmlString), opt);
            };
            this.parseXML = function (oXMLParent, opt) {
                for (var key in opt) {
                    options[key] = opt[key];
                }
                var vResult = {}, nLength = 0, sCollectedTxt = "";
                if (options.xmlns && oXMLParent.namespaceURI) {
                    vResult[options.namespaceKey] = oXMLParent.namespaceURI;
                }
                if (oXMLParent.attributes && oXMLParent.attributes.length > 0) {
                    var vAttribs = {};
                    for (nLength; nLength < oXMLParent.attributes.length; nLength++) {
                        var oAttrib = oXMLParent.attributes.item(nLength);
                        vContent = {};
                        var attribName = '';
                        if (options.stripAttrPrefix) {
                            attribName = oAttrib.name.replace(prefixMatch, '');
                        }
                        else {
                            attribName = oAttrib.name;
                        }
                        if (options.grokAttr) {
                            vContent[options.valueKey] = this.grokType(oAttrib.value.replace(trimMatch, ''));
                        }
                        else {
                            vContent[options.valueKey] = oAttrib.value.replace(trimMatch, '');
                        }
                        if (options.xmlns && oAttrib.namespaceURI) {
                            vContent[options.namespaceKey] = oAttrib.namespaceURI;
                        }
                        if (options.attrsAsObject) {
                            vAttribs[attribName] = vContent;
                        }
                        else {
                            vResult[options.attrKey + attribName] = vContent;
                        }
                    }
                    if (options.attrsAsObject) {
                        vResult[options.attrKey] = vAttribs;
                    }
                    else {
                    }
                }
                if (oXMLParent.hasChildNodes()) {
                    for (var oNode, sProp, vContent, nItem = 0; nItem < oXMLParent.childNodes.length; nItem++) {
                        oNode = oXMLParent.childNodes.item(nItem);
                        if (oNode.nodeType === 4) {
                            if (options.mergeCDATA) {
                                sCollectedTxt += oNode.nodeValue;
                            }
                            else {
                                if (vResult.hasOwnProperty(options.cdataKey)) {
                                    if (vResult[options.cdataKey].constructor !== Array) {
                                        vResult[options.cdataKey] = [vResult[options.cdataKey]];
                                    }
                                    vResult[options.cdataKey].push(oNode.nodeValue);
                                }
                                else {
                                    if (options.childrenAsArray) {
                                        vResult[options.cdataKey] = [];
                                        vResult[options.cdataKey].push(oNode.nodeValue);
                                    }
                                    else {
                                        vResult[options.cdataKey] = oNode.nodeValue;
                                    }
                                }
                            }
                        }
                        else if (oNode.nodeType === 3) {
                            sCollectedTxt += oNode.nodeValue;
                        }
                        else if (oNode.nodeType === 1) {
                            if (nLength === 0) {
                                vResult = {};
                            }
                            if (options.stripElemPrefix) {
                                sProp = oNode.nodeName.replace(prefixMatch, '');
                            }
                            else {
                                sProp = oNode.nodeName;
                            }
                            vContent = xmlToJSON.parseXML(oNode);
                            if (vResult.hasOwnProperty(sProp)) {
                                if (vResult[sProp].constructor !== Array) {
                                    vResult[sProp] = [vResult[sProp]];
                                }
                                vResult[sProp].push(vContent);
                            }
                            else {
                                if (options.childrenAsArray) {
                                    vResult[sProp] = [];
                                    vResult[sProp].push(vContent);
                                }
                                else {
                                    vResult[sProp] = vContent;
                                }
                                nLength++;
                            }
                        }
                    }
                }
                else if (!sCollectedTxt) {
                    if (options.childrenAsArray) {
                        vResult[options.textKey] = [];
                        vResult[options.textKey].push(null);
                    }
                    else {
                        vResult[options.textKey] = null;
                    }
                }
                if (sCollectedTxt) {
                    if (options.grokText) {
                        var value = this.grokType(sCollectedTxt.replace(trimMatch, ''));
                        if (value !== null && value !== undefined) {
                            vResult[options.textKey] = value;
                        }
                    }
                    else if (options.normalize) {
                        vResult[options.textKey] = sCollectedTxt.replace(trimMatch, '').replace(/\s+/g, " ");
                    }
                    else {
                        vResult[options.textKey] = sCollectedTxt.replace(trimMatch, '');
                    }
                }
                return vResult;
            };
            this.xmlToString = function (xmlDoc) {
                try {
                    var xmlString = xmlDoc.xml ? xmlDoc.xml : (new XMLSerializer()).serializeToString(xmlDoc);
                    return xmlString;
                }
                catch (err) {
                    return null;
                }
            };
            this.stringToXML = function (xmlString) {
                try {
                    var xmlDoc = null;
                    if (window.DOMParser) {
                        var parser = new DOMParser();
                        xmlDoc = parser.parseFromString(xmlString, "text/xml");
                        return xmlDoc;
                    }
                    else {
                        xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
                        xmlDoc.async = false;
                        xmlDoc.loadXML(xmlString);
                        return xmlDoc;
                    }
                }
                catch (e) {
                    return null;
                }
            };
            return this;
        }).call({});
        return xmlToJSON;
    };
    Lib.ReduxLoggerMiddleware = function (store) { return function (next) { return function (action) {
        var result = next(action);
        return result;
    }; }; };
    Lib = __decorate([
        core_1.Injectable(), 
        __metadata('design:paramtypes', [])
    ], Lib);
    return Lib;
})();
exports.Lib = Lib;
if (!Object.assign) {
    Object.defineProperty(Object, "assign", {
        enumerable: false,
        configurable: true,
        writable: true,
        value: function (target) {
            "use strict";
            if (target === undefined || target === null) {
                throw new TypeError("Cannot convert first argument to object");
            }
            var to = Object(target);
            for (var i = 1; i < arguments.length; i++) {
                var nextSource = arguments[i];
                if (nextSource === undefined || nextSource === null) {
                    continue;
                }
                nextSource = Object(nextSource);
                var keysArray = Object.keys(nextSource);
                for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {
                    var nextKey = keysArray[nextIndex];
                    var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);
                    if (desc !== undefined && desc.enumerable) {
                        to[nextKey] = nextSource[nextKey];
                    }
                }
            }
            return to;
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi50cyJdLCJuYW1lcyI6WyJMaWIiLCJMaWIuY29uc3RydWN0b3IiLCJMaWIuU3RvcmVGYWN0b3J5IiwiTGliLkxvYWRDb21wb25lbnRBc3luYyIsIkxpYi5sb2ciLCJMaWIuZ3VpZCIsIkxpYi5ndWlkLnM0IiwiTGliLlhtbDJKc29uIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFFQSxxQkFBeUIsZUFBZSxDQUFDLENBQUE7QUFDekMsc0JBQXFFLE9BQU8sQ0FBQyxDQUFBO0FBQzdFLElBQVksZUFBZSxXQUFNLGFBQWEsQ0FBQyxDQUFBO0FBQy9DLG9DQUF1QixxQkFBcUIsQ0FBQyxDQUFBO0FBSTdDO0lBQUFBO0lBcVNBQyxDQUFDQTtJQWxTVUQsZ0JBQVlBLEdBQW5CQSxVQUFvQkEsV0FBa0JBO1FBQ2xDRSxNQUFNQSxDQUFDQTtZQUNIQSxJQUFNQSxRQUFRQSxHQUFHQSx1QkFBZUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0E7WUFFOUNBLElBQU1BLGtCQUFrQkEsR0FBR0EsdUJBQWVBLENBQU1BLGVBQWVBLENBQUNBLENBQUNBO1lBQ2pFQSxJQUFNQSxPQUFPQSxHQUFHQSxNQUFNQSxDQUFDQSxpQkFBaUJBLENBQUNBO1lBQ3pDQSxJQUFNQSxhQUFhQSxHQUFHQSxjQUFNQSxPQUFBQSxPQUFPQSxHQUFHQSxNQUFNQSxDQUFDQSxpQkFBaUJBLEVBQUVBLEdBQUdBLFVBQUFBLENBQUNBLElBQUlBLE9BQUFBLENBQUNBLEVBQURBLENBQUNBLEVBQTdDQSxDQUE2Q0EsQ0FBQ0E7WUFDMUVBLElBQU1BLFNBQVNBLEdBQUdBLGVBQU9BLENBQUNBLGtCQUFrQkEsRUFBRUEsYUFBYUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDL0RBLElBQU1BLHdCQUF3QkEsR0FBR0EsU0FBU0EsQ0FBQ0EsbUJBQVdBLENBQUNBLENBQUNBO1lBQ3hEQSxJQUFNQSxhQUFhQSxHQUFHQSx3QkFBd0JBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO1lBQ3pEQSxNQUFNQSxDQUFDQSxJ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QkFDRCxVQUFVLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUVoQyxJQUFJLFNBQVMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUN4QyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxTQUFTLEdBQUcsR0FBRyxFQUFFLFNBQVMsRUFBRSxFQUFFLENBQUM7b0JBQzNFLElBQUksT0FBTyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztvQkFDbkMsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLHdCQUF3QixDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztvQkFDaEUsRUFBRSxDQUFDLENBQUMsSUFBSSxLQUFLLFNBQVMsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQzt3QkFDeEMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDdEMsQ0FBQztnQkFDTCxDQUFDO1lBQ0wsQ0FBQztZQUNELE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFDZCxDQUFDO0tBQ0osQ0FBQyxDQUFDO0FBQ1AsQ0FBQyIsImZpbGUiOiJMaWIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiogQ29tbW9uIExpYnJhcnkgKiovXHJcblxyXG5pbXBvcnQge0luamVjdGFibGV9IGZyb20gJ2FuZ3VsYXIyL2NvcmUnO1xyXG5pbXBvcnQge2NyZWF0ZVN0b3JlLCBjb21iaW5lUmVkdWNlcnMsIGFwcGx5TWlkZGxld2FyZSwgY29tcG9zZX0gZnJvbSBcInJlZHV4XCI7XHJcbmltcG9ydCAqIGFzIHRodW5rTWlkZGxld2FyZSBmcm9tICdyZWR1eC10aHVuayc7XHJcbmltcG9ydCB7QXBwU3RvcmV9IGZyb20gXCJhbmd1bGFyMi1yZWR1eC11dGlsXCI7XHJcblxyXG5pbXBvcnQge0xvZ2dlck1pZGRsZXdhcmV9IGZyb20gXCJhbmd1bGFyMi1yZWR1eC11dGlsXCI7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBMaWIge1xyXG5cclxuICAgIHN0YXRpYyBTdG9yZUZhY3RvcnkocmVkdWNlckxpc3Q6T2JqZWN0KSB7XHJcbiAgICAgICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVkdWNlcnMgPSBjb21iaW5lUmVkdWNlcnMocmVkdWNlckxpc3QpO1xyXG4gICAgICAgICAgICAvL2NvbnN0IG1pZGRsZXdhcmVFbmhhbmNlciA9IGFwcGx5TWlkZGxld2FyZSg8YW55PnRodW5rTWlkZGxld2FyZSwgTG9nZ2VyTWlkZGxld2FyZSk7IC8vIHRvIGVuYWJsZSBsb2dnZXJcclxuICAgICAgICAgICAgY29uc3QgbWlkZGxld2FyZUVuaGFuY2VyID0gYXBwbHlNaWRkbGV3YXJlKDxhbnk+dGh1bmtNaWRkbGV3YXJlKTtcclxuICAgICAgICAgICAgY29uc3QgaXNEZWJ1ZyA9IHdpbmRvdy5kZXZUb29sc0V4dGVuc2lvbjtcclxuICAgICAgICAgICAgY29uc3QgYXBwbHlEZXZUb29scyA9ICgpID0+IGlzRGVidWcgPyB3aW5kb3cuZGV2VG9vbHNFeHRlbnNpb24oKSA6IGYgPT4gZjtcclxuICAgICAgICAgICAgY29uc3QgZW5oYW5jZXJzID0gY29tcG9zZShtaWRkbGV3YXJlRW5oYW5jZXIsIGFwcGx5RGV2VG9vbHMoKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNyZWF0ZVN0b3JlV2l0aEVuaGFuY2VycyA9IGVuaGFuY2VycyhjcmVhdGVTdG9yZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlZHV4QXBwU3RvcmUgPSBjcmVhdGVTdG9yZVdpdGhFbmhhbmNlcnMocmVkdWNlcnMpO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEFwcFN0b3JlKHJlZHV4QXBwU3RvcmUpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIExvYWRDb21wb25lbnRBc3luYyhuYW1lOnN0cmluZywgcGF0aDpzdHJpbmcpIHtcclxuXHJcbiAgICAgICAgcmV0dXJuIFN5c3RlbS5pbXBvcnQocGF0aCkudGhlbihjID0+IGNbbmFtZV0pO1xyXG5cclxuICAgICAgICAvLyBidW5kbGVzOiB7XHJcbiAgICAgICAgLy8gICAgIFwibWFpbi1idW5kbGVcIjogW1xyXG4gICAgICAgIC8vICAgICAgICAgXCJkaXN0L3B1YmxpYy9BcHAxXCIsXHJcbiAgICAgICAgLy8gICAgICAgICBcIm1haW4tYnVuZGxlL0FwcDFcIixcclxuICAgICAgICAvLyAgICAgICAgIFwiZGlzdC9wdWJsaWMvQXBwMS50c1wiLFxyXG4gICAgICAgIC8vICAgICAgICAgXCIvZGlzdC9wdWJsaWMvQXBwMVwiLFxyXG4gICAgICAgIC8vICAgICAgICAgXCJBcHAxXCIsXHJcbiAgICAgICAgLy8gICAgICAgICBcInB1YmxpYy9BcHAxXCIsXHJcbiAgICAgICAgLy8gICAgICAgICBcImRpc3QvcHVibGljL0FwcDFcIixcclxuICAgICAgICAvLyAgICAgICAgIFwic3JjL2NvbXBzL2FwcDEvQXBwMS5qc1wiXHJcbiAgICAgICAgLy8gICAgIF1cclxuICAgICAgICAvLyB9LFxyXG5cclxuICAgICAgICAvL3JldHVybiBTeXN0ZW0uaW1wb3J0KCcvZGlzdC9wdWJsaWMvb3V0LmpzJylcclxuICAgICAgICAvLyAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAvLyAgICAgICAgYWxlcnQoJ3Byb2IgbG9hZGluZyBvdXQuanMgJyArIGUpO1xyXG4gICAgICAgIC8vICAgIH0pLnRoZW4oZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAvLyAgICAgICAgYWxlcnQoZSk7XHJcbiAgICAgICAgLy8gICAgICAgIGFsZXJ0KGVbbmFtZV0pO1xyXG4gICAgICAgIC8vICAgICAgICBhbGVydChKU09OLnN0cmluZ2lmeShlKSk7XHJcbiAgICAgICAgLy8gICAgICAgIHJldHVybiBTeXN0ZW0uaW1wb3J0KCdBcHAxJykudGhlbihjID0+IGNbbmFtZV0pO1xyXG4gICAgICAgIC8vICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBsb2cobXNnKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2cobmV3IERhdGUoKS50b1RpbWVTdHJpbmcoKS5yZXBsYWNlKC8uKihcXGR7Mn06XFxkezJ9OlxcZHsyfSkuKi8sIFwiJDFcIikgKyAnOiAnICsgbXNnKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ3VpZCgpOnN0cmluZyB7XHJcbiAgICAgICAgZnVuY3Rpb24gczQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKCgxICsgTWF0aC5yYW5kb20oKSkgKiAweDEwMDAwKVxyXG4gICAgICAgICAgICAgICAgLnRvU3RyaW5nKDE2KVxyXG4gICAgICAgICAgICAgICAgLnN1YnN0cmluZygxKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzNCgpICsgczQoKSArICctJyArIHM0KCkgKyAnLScgKyBzNCgpICsgJy0nICtcclxuICAgICAgICAgICAgczQoKSArICctJyArIHM0KCkgKyBzNCgpICsgczQoKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgUmVkdXhMb2dnZXJNaWRkbGV3YXJlID0gc3RvcmUgPT4gbmV4dCA9PiBhY3Rpb24gPT4ge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZGlzcGF0Y2hpbmdcIiwgYWN0aW9uLnR5cGUpO1xyXG4gICAgICAgIGxldCByZXN1bHQgPSBuZXh0KGFjdGlvbik7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcIm5leHQgc3RhdGVcIiwgc3RvcmUuZ2V0U3RhdGUoKSk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgfTtcclxuXHJcbiAgICBzdGF0aWMgWG1sMkpzb24oKSB7XHJcbiAgICAgICAgLy9odHRwczovL2dpdGh1Yi5jb20vbWV0YXRyaWJhbC94bWxUb0pTT05cclxuICAgICAgICB2YXIgeG1sVG9KU09OID0gKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IFwiMS4zXCI7XHJcblxyXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHsgLy8gc2V0IHVwIHRoZSBkZWZhdWx0IG9wdGlvbnNcclxuICAgICAgICAgICAgICAgIG1lcmdlQ0RBVEE6IHRydWUsIC8vIGV4dHJhY3QgY2RhdGEgYW5kIG1lcmdlIHdpdGggdGV4dFxyXG4gICAgICAgICAgICAgICAgZ3Jva0F0dHI6IHRydWUsIC8vIGNvbnZlcnQgdHJ1dGh5IGF0dHJpYnV0ZXMgdG8gYm9vbGVhbiwgZXRjXHJcbiAgICAgICAgICAgICAgICBncm9rVGV4dDogdHJ1ZSwgLy8gY29udmVydCB0cnV0aHkgdGV4dC9hdHRyIHRvIGJvb2xlYW4sIGV0Y1xyXG4gICAgICAgICAgICAgICAgbm9ybWFsaXplOiB0cnVlLCAvLyBjb2xsYXBzZSBtdWx0aXBsZSBzcGFjZXMgdG8gc2luZ2xlIHNwYWNlXHJcbiAgICAgICAgICAgICAgICB4bWxuczogdHJ1ZSwgLy8gaW5jbHVkZSBuYW1lc3BhY2VzIGFzIGF0dHJpYnV0ZSBpbiBvdXRwdXRcclxuICAgICAgICAgICAgICAgIG5hbWVzcGFjZUtleTogJ19ucycsIC8vIHRhZyBuYW1lIGZvciBuYW1lc3BhY2Ugb2JqZWN0c1xyXG4gICAgICAgICAgICAgICAgdGV4dEtleTogJ190ZXh0JywgLy8gdGFnIG5hbWUgZm9yIHRleHQgbm9kZXNcclxuICAgICAgICAgICAgICAgIHZhbHVlS2V5OiAnX3ZhbHVlJywgLy8gdGFnIG5hbWUgZm9yIGF0dHJpYnV0ZSB2YWx1ZXNcclxuICAgICAgICAgICAgICAgIGF0dHJLZXk6ICdfYXR0cicsIC8vIHRhZyBmb3IgYXR0ciBncm91cHNcclxuICAgICAgICAgICAgICAgIGNkYXRhS2V5OiAnX2NkYXRhJywgLy8gdGFnIGZvciBjZGF0YSBub2RlcyAoaWdub3JlZCBpZiBtZXJnZUNEQVRBIGlzIHRydWUpXHJcbiAgICAgICAgICAgICAgICBhdHRyc0FzT2JqZWN0OiB0cnVlLCAvLyBpZiBmYWxzZSwga2V5IGlzIHVzZWQgYXMgcHJlZml4IHRvIG5hbWUsIHNldCBwcmVmaXggdG8gJycgdG8gbWVyZ2UgY2hpbGRyZW4gYW5kIGF0dHJzLlxyXG4gICAgICAgICAgICAgICAgc3RyaXBBdHRyUHJlZml4OiB0cnVlLCAvLyByZW1vdmUgbmFtZXNwYWNlIHByZWZpeGVzIGZyb20gYXR0cmlidXRlc1xyXG4gICAgICAgICAgICAgICAgc3RyaXBFbGVtUHJlZml4OiB0cnVlLCAvLyBmb3IgZWxlbWVudHMgb2Ygc2FtZSBuYW1lIGluIGRpZmYgbmFtZXNwYWNlcywgeW91IGNhbiBlbmFibGUgbmFtZXNwYWNlcyBhbmQgYWNjZXNzIHRoZSBuc2tleSBwcm9wZXJ0eVxyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW5Bc0FycmF5OiB0cnVlIC8vIGZvcmNlIGNoaWxkcmVuIGludG8gYXJyYXlzXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgcHJlZml4TWF0Y2g6YW55ID0gbmV3IFJlZ0V4cCgnKD8heG1sbnMpXi4qOi8nKTtcclxuICAgICAgICAgICAgdmFyIHRyaW1NYXRjaDphbnkgPSBuZXcgUmVnRXhwKCdeXFxzK3xcXHMrJGcnKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZ3Jva1R5cGUgPSBmdW5jdGlvbiAoc1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoL15cXHMqJC8udGVzdChzVmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoL14oPzp0cnVlfGZhbHNlKSQvaS50ZXN0KHNWYWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc1ZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IFwidHJ1ZVwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGlzRmluaXRlKHNWYWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNWYWx1ZTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucGFyc2VTdHJpbmcgPSBmdW5jdGlvbiAoeG1sU3RyaW5nLCBvcHQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlWE1MKHRoaXMuc3RyaW5nVG9YTUwoeG1sU3RyaW5nKSwgb3B0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5wYXJzZVhNTCA9IGZ1bmN0aW9uIChvWE1MUGFyZW50LCBvcHQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXplIG9wdGlvbnNcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBvcHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zW2tleV0gPSBvcHRba2V5XTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdlJlc3VsdCA9IHt9LFxyXG4gICAgICAgICAgICAgICAgICAgIG5MZW5ndGggPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgIHNDb2xsZWN0ZWRUeHQgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHBhcnNlIG5hbWVzcGFjZSBpbmZvcm1hdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMueG1sbnMgJiYgb1hNTFBhcmVudC5uYW1lc3BhY2VVUkkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W29wdGlvbnMubmFtZXNwYWNlS2V5XSA9IG9YTUxQYXJlbnQubmFtZXNwYWNlVVJJO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIHBhcnNlIGF0dHJpYnV0ZXNcclxuICAgICAgICAgICAgICAgIC8vIHVzaW5nIGF0dHJpYnV0ZXMgcHJvcGVydHkgaW5zdGVhZCBvZiBoYXNBdHRyaWJ1dGVzIG1ldGhvZCB0byBzdXBwb3J0IG9sZGVyIGJyb3dzZXJzXHJcbiAgICAgICAgICAgICAgICBpZiAob1hNTFBhcmVudC5hdHRyaWJ1dGVzICYmIG9YTUxQYXJlbnQuYXR0cmlidXRlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZBdHRyaWJzID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobkxlbmd0aDsgbkxlbmd0aCA8IG9YTUxQYXJlbnQuYXR0cmlidXRlcy5sZW5ndGg7IG5MZW5ndGgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb0F0dHJpYiA9IG9YTUxQYXJlbnQuYXR0cmlidXRlcy5pdGVtKG5MZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2Q29udGVudCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmliTmFtZSA9ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RyaXBBdHRyUHJlZml4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJOYW1lID0gb0F0dHJpYi5uYW1lLnJlcGxhY2UocHJlZml4TWF0Y2gsICcnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJOYW1lID0gb0F0dHJpYi5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5ncm9rQXR0cikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdkNvbnRlbnRbb3B0aW9ucy52YWx1ZUtleV0gPSB0aGlzLmdyb2tUeXBlKG9BdHRyaWIudmFsdWUucmVwbGFjZSh0cmltTWF0Y2gsICcnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Q29udGVudFtvcHRpb25zLnZhbHVlS2V5XSA9IG9BdHRyaWIudmFsdWUucmVwbGFjZSh0cmltTWF0Y2gsICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMueG1sbnMgJiYgb0F0dHJpYi5uYW1lc3BhY2VVUkkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZDb250ZW50W29wdGlvbnMubmFtZXNwYWNlS2V5XSA9IG9BdHRyaWIubmFtZXNwYWNlVVJJO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5hdHRyc0FzT2JqZWN0KSB7IC8vIGF0dHJpYnV0ZXMgd2l0aCBzYW1lIGxvY2FsIG5hbWUgbXVzdCBlbmFibGUgcHJlZml4ZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZBdHRyaWJzW2F0dHJpYk5hbWVdID0gdkNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W29wdGlvbnMuYXR0cktleSArIGF0dHJpYk5hbWVdID0gdkNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmF0dHJzQXNPYmplY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtvcHRpb25zLmF0dHJLZXldID0gdkF0dHJpYnM7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHRoZSBjaGlsZHJlblxyXG4gICAgICAgICAgICAgICAgaWYgKG9YTUxQYXJlbnQuaGFzQ2hpbGROb2RlcygpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgb05vZGUsIHNQcm9wLCB2Q29udGVudCwgbkl0ZW0gPSAwOyBuSXRlbSA8IG9YTUxQYXJlbnQuY2hpbGROb2Rlcy5sZW5ndGg7IG5JdGVtKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb05vZGUgPSBvWE1MUGFyZW50LmNoaWxkTm9kZXMuaXRlbShuSXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob05vZGUubm9kZVR5cGUgPT09IDQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1lcmdlQ0RBVEEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzQ29sbGVjdGVkVHh0ICs9IG9Ob2RlLm5vZGVWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZSZXN1bHQuaGFzT3duUHJvcGVydHkob3B0aW9ucy5jZGF0YUtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZSZXN1bHRbb3B0aW9ucy5jZGF0YUtleV0uY29uc3RydWN0b3IgIT09IEFycmF5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W29wdGlvbnMuY2RhdGFLZXldID0gW3ZSZXN1bHRbb3B0aW9ucy5jZGF0YUtleV1dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbb3B0aW9ucy5jZGF0YUtleV0ucHVzaChvTm9kZS5ub2RlVmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5jaGlsZHJlbkFzQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbb3B0aW9ucy5jZGF0YUtleV0gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbb3B0aW9ucy5jZGF0YUtleV0ucHVzaChvTm9kZS5ub2RlVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtvcHRpb25zLmNkYXRhS2V5XSA9IG9Ob2RlLm5vZGVWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSAvKiBub2RlVHlwZSBpcyBcIkNEQVRBU2VjdGlvblwiICg0KSAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChvTm9kZS5ub2RlVHlwZSA9PT0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc0NvbGxlY3RlZFR4dCArPSBvTm9kZS5ub2RlVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gLyogbm9kZVR5cGUgaXMgXCJUZXh0XCIgKDMpICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9Ob2RlLm5vZGVUeXBlID09PSAxKSB7IC8qIG5vZGVUeXBlIGlzIFwiRWxlbWVudFwiICgxKSAqL1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuTGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzaW5nIG5vZGVOYW1lIHRvIHN1cHBvcnQgYnJvd3NlciAoSUUpIGltcGxlbWVudGF0aW9uIHdpdGggbm8gJ2xvY2FsTmFtZScgcHJvcGVydHlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN0cmlwRWxlbVByZWZpeCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNQcm9wID0gb05vZGUubm9kZU5hbWUucmVwbGFjZShwcmVmaXhNYXRjaCwgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzUHJvcCA9IG9Ob2RlLm5vZGVOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZDb250ZW50ID0geG1sVG9KU09OLnBhcnNlWE1MKG9Ob2RlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodlJlc3VsdC5oYXNPd25Qcm9wZXJ0eShzUHJvcCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodlJlc3VsdFtzUHJvcF0uY29uc3RydWN0b3IgIT09IEFycmF5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbc1Byb3BdID0gW3ZSZXN1bHRbc1Byb3BdXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtzUHJvcF0ucHVzaCh2Q29udGVudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5jaGlsZHJlbkFzQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtzUHJvcF0gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtzUHJvcF0ucHVzaCh2Q29udGVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtzUHJvcF0gPSB2Q29udGVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbkxlbmd0aCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghc0NvbGxlY3RlZFR4dCkgeyAvLyBubyBjaGlsZHJlbiBhbmQgbm8gdGV4dCwgcmV0dXJuIG51bGxcclxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5jaGlsZHJlbkFzQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtvcHRpb25zLnRleHRLZXldID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbb3B0aW9ucy50ZXh0S2V5XS5wdXNoKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbb3B0aW9ucy50ZXh0S2V5XSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzQ29sbGVjdGVkVHh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ3Jva1RleHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5ncm9rVHlwZShzQ29sbGVjdGVkVHh0LnJlcGxhY2UodHJpbU1hdGNoLCAnJykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtvcHRpb25zLnRleHRLZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMubm9ybWFsaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbb3B0aW9ucy50ZXh0S2V5XSA9IHNDb2xsZWN0ZWRUeHQucmVwbGFjZSh0cmltTWF0Y2gsICcnKS5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W29wdGlvbnMudGV4dEtleV0gPSBzQ29sbGVjdGVkVHh0LnJlcGxhY2UodHJpbU1hdGNoLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB2UmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgLy8gQ29udmVydCB4bWxEb2N1bWVudCB0byBhIHN0cmluZ1xyXG4gICAgICAgICAgICAvLyBSZXR1cm5zIG51bGwgb24gZmFpbHVyZVxyXG4gICAgICAgICAgICB0aGlzLnhtbFRvU3RyaW5nID0gZnVuY3Rpb24gKHhtbERvYykge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgeG1sU3RyaW5nID0geG1sRG9jLnhtbCA/IHhtbERvYy54bWwgOiAobmV3IFhNTFNlcmlhbGl6ZXIoKSkuc2VyaWFsaXplVG9TdHJpbmcoeG1sRG9jKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4geG1sU3RyaW5nO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENvbnZlcnQgYSBzdHJpbmcgdG8gWE1MIE5vZGUgU3RydWN0dXJlXHJcbiAgICAgICAgICAgIC8vIFJldHVybnMgbnVsbCBvbiBmYWlsdXJlXHJcbiAgICAgICAgICAgIHRoaXMuc3RyaW5nVG9YTUwgPSBmdW5jdGlvbiAoeG1sU3RyaW5nKSB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4bWxEb2MgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LkRPTVBhcnNlcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeG1sRG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyh4bWxTdHJpbmcsIFwidGV4dC94bWxcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geG1sRG9jO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHhtbERvYyA9IG5ldyBBY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTERPTVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeG1sRG9jLmFzeW5jID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHhtbERvYy5sb2FkWE1MKHhtbFN0cmluZyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geG1sRG9jO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSkuY2FsbCh7fSk7XHJcbiAgICAgICAgcmV0dXJuIHhtbFRvSlNPTjtcclxuICAgIH1cclxuXHJcblxyXG59XHJcblxyXG5cclxuLyogdHNsaW50OmRpc2FibGUgKi9cclxuLy8gcG9seWZpbGwgZm9yIE9iamVjdC5hc3NpZ24gKG5vdCBwYXJ0IG9mIFRTIHlldClcclxuLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvT2JqZWN0L2Fzc2lnblxyXG5pZiAoIU9iamVjdC5hc3NpZ24pIHtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShPYmplY3QsIFwiYXNzaWduXCIsIHtcclxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXHJcbiAgICAgICAgd3JpdGFibGU6IHRydWUsXHJcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXQgPT09IHVuZGVmaW5lZCB8fCB0YXJnZXQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY29udmVydCBmaXJzdCBhcmd1bWVudCB0byBvYmplY3RcIik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciB0byA9IE9iamVjdCh0YXJnZXQpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG5leHRTb3VyY2UgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAobmV4dFNvdXJjZSA9PT0gdW5kZWZpbmVkIHx8IG5leHRTb3VyY2UgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG5leHRTb3VyY2UgPSBPYmplY3QobmV4dFNvdXJjZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGtleXNBcnJheSA9IE9iamVjdC5rZXlzKG5leHRTb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbmV4dEluZGV4ID0gMCwgbGVuID0ga2V5c0FycmF5Lmxlbmd0aDsgbmV4dEluZGV4IDwgbGVuOyBuZXh0SW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXh0S2V5ID0ga2V5c0FycmF5W25leHRJbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG5leHRTb3VyY2UsIG5leHRLZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZXNjICE9PSB1bmRlZmluZWQgJiYgZGVzYy5lbnVtZXJhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvW25leHRLZXldID0gbmV4dFNvdXJjZVtuZXh0S2V5XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRvO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
