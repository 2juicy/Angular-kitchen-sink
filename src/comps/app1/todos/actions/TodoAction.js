var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("angular2/core");
var angular2_redux_util_1 = require("angular2-redux-util");
var TodoModel_1 = require("../TodoModel");
var StoreModel_1 = require("../../../../models/StoreModel");
var TodoService_1 = require("../TodoService");
var http_1 = require("angular2/http");
var TodoStatsModel_1 = require("../TodoStatsModel");
var CommBroker_1 = require("../../../../services/CommBroker");
exports.ADD_TODO = 'ADD_TODO';
exports.REMOVE_TODO = 'REMOVE_TODO';
exports.EDIT_TODO = 'EDIT_TODO';
exports.CLEAR_TODOS = 'CLEAR_TODOS';
var TodoAction = (function (_super) {
    __extends(TodoAction, _super);
    function TodoAction(appStore) {
        _super.call(this);
        this.appStore = appStore;
    }
    TodoAction.prototype.factoryTodoService = function () {
        if (this.service)
            return this.service;
        var injector = core_1.Injector.resolveAndCreate([
            TodoService_1.TodoService,
            TodoAction,
            http_1.HTTP_PROVIDERS,
            TodoStatsModel_1.default,
            core_1.provide(CommBroker_1.CommBroker, { useClass: CommBroker_1.CommBroker }),
            core_1.provide(angular2_redux_util_1.AppStore, { useValue: this.appStore })
        ]);
        this.service = injector.get(TodoService_1.TodoService);
    };
    TodoAction.prototype.addTodo = function (task, id) {
        var _this = this;
        this.factoryTodoService();
        return function (dispatch) {
            var modelId = id || StoreModel_1.StoreModel.UniqueId();
            var todoModel = new TodoModel_1.TodoModel({ task: task, modelId: modelId });
            _this.service.saveTodoRemote(todoModel, function (status) {
                if (status == -1) {
                    bootbox.alert('problem saving to server 1');
                    return;
                }
                dispatch(_this.addTodoDispatch(todoModel));
            });
        };
    };
    TodoAction.prototype.addTodoDispatch = function (todoModel) {
        return { type: exports.ADD_TODO, todoModel: todoModel };
    };
    TodoAction.prototype.clearTodoDispatch = function () {
        return { type: exports.CLEAR_TODOS };
    };
    TodoAction.prototype.removeTodo = function (todoModel) {
        var _this = this;
        this.factoryTodoService();
        return function (dispatch) {
            _this.service.removeTodoRemote(todoModel, function (status) {
                if (status == -1) {
                    bootbox.alert('problem saving to server 2');
                    return;
                }
                dispatch(_this.removeTodoDispatch(todoModel));
            });
        };
    };
    TodoAction.prototype.removeTodoDispatch = function (todoModel) {
        return { type: exports.REMOVE_TODO, modelId: todoModel.getKey('modelId') };
    };
    TodoAction.prototype.editTodo = function (todoModel) {
        var _this = this;
        this.factoryTodoService();
        return function (dispatch) {
            dispatch(_this.editTodoDispatch(todoModel));
            _this.service.editTodoRemote(todoModel, function (status) {
                if (status == -1) {
                    bootbox.alert('problem saving to server 3');
                    return;
                }
            });
        };
    };
    TodoAction.prototype.editTodoDispatch = function (todoModel) {
        return { type: exports.EDIT_TODO, modelId: todoModel.getKey('modelId'), key: 'task', value: todoModel['task'] };
    };
    TodoAction = __decorate([
        core_1.Injectable(), 
        __metadata('design:paramtypes', [angular2_redux_util_1.AppStore])
    ], TodoAction);
    return TodoAction;
})(angular2_redux_util_1.Actions);
exports.TodoAction = TodoAction;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBzL2FwcDEvdG9kb3MvYWN0aW9ucy90b2RvYWN0aW9uLnRzIl0sIm5hbWVzIjpbIlRvZG9BY3Rpb24iLCJUb2RvQWN0aW9uLmNvbnN0cnVjdG9yIiwiVG9kb0FjdGlvbi5mYWN0b3J5VG9kb1NlcnZpY2UiLCJUb2RvQWN0aW9uLmFkZFRvZG8iLCJUb2RvQWN0aW9uLmFkZFRvZG9EaXNwYXRjaCIsIlRvZG9BY3Rpb24uY2xlYXJUb2RvRGlzcGF0Y2giLCJUb2RvQWN0aW9uLnJlbW92ZVRvZG8iLCJUb2RvQWN0aW9uLnJlbW92ZVRvZG9EaXNwYXRjaCIsIlRvZG9BY3Rpb24uZWRpdFRvZG8iLCJUb2RvQWN0aW9uLmVkaXRUb2RvRGlzcGF0Y2giXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEscUJBQXVELGVBQWUsQ0FBQyxDQUFBO0FBQ3ZFLG9DQUFnQyxxQkFBcUIsQ0FBQyxDQUFBO0FBQ3RELDBCQUF3QixjQUFjLENBQUMsQ0FBQTtBQUN2QywyQkFBeUIsK0JBQStCLENBQUMsQ0FBQTtBQUN6RCw0QkFBMEIsZ0JBQWdCLENBQUMsQ0FBQTtBQUMzQyxxQkFBNkIsZUFBZSxDQUFDLENBQUE7QUFDN0MsK0JBQTJCLG1CQUFtQixDQUFDLENBQUE7QUFDL0MsMkJBQXlCLGlDQUFpQyxDQUFDLENBQUE7QUFFOUMsZ0JBQVEsR0FBRyxVQUFVLENBQUM7QUFDdEIsbUJBQVcsR0FBRyxhQUFhLENBQUM7QUFDNUIsaUJBQVMsR0FBRyxXQUFXLENBQUM7QUFDeEIsbUJBQVcsR0FBRyxhQUFhLENBQUM7QUFFekM7SUFDZ0NBLDhCQUFPQTtJQUluQ0Esb0JBQW9CQSxRQUFpQkE7UUFDakNDLGlCQUFPQSxDQUFDQTtRQURRQSxhQUFRQSxHQUFSQSxRQUFRQSxDQUFTQTtJQUVyQ0EsQ0FBQ0E7SUFFT0QsdUNBQWtCQSxHQUExQkE7UUFpQ0lFLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBO1lBQ2JBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBO1FBRXhCQSxJQUFJQSxRQUFRQSxHQUFHQSxlQUFRQSxDQUFDQSxnQkFBZ0JBLENBQ3BDQTtZQUNJQSx5QkFBV0E7WUFDWEEsVUFBVUE7WUFDVkEscUJBQWNBO1lBQ2RBLHdCQUFjQTtZQUNkQSxjQUFPQSxDQUFDQSx1QkFBVUEsRUFBRUEsRUFBQ0EsUUFBUUEsRUFBRUEsdUJBQVVBLEVBQUNBLENBQUNBO1lBQzNDQSxjQUFPQSxDQUFDQSw4QkFBUUEsRUFBRUEsRUFBQ0EsUUFBUUEsRUFBRUEsSUFBSUEsQ0FBQ0EsUUFBUUEsRUFBQ0EsQ0FBQ0E7U0FDL0NBLENBQUNBLENBQUNBO1FBQ1BBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLFFBQVFBLENBQUNBLEdBQUdBLENBQUNBLHlCQUFXQSxDQUFDQSxDQUFDQTtJQUM3Q0EsQ0FBQ0E7SUFFTUYsNEJBQU9BLEdBQWRBLFVBQWVBLElBQVdBLEVBQUVBLEVBQVVBO1FBQXRDRyxpQkFjQ0E7UUFiR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxFQUFFQSxDQUFDQTtRQUMxQkEsTUFBTUEsQ0FBQ0EsVUFBQ0EsUUFBUUE7WUFDWkEsSUFBSUEsT0FBT0EsR0FBR0EsRUFBRUEsSUFBSUEsdUJBQVVBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBO1lBQzFDQSxJQUFJQSxTQUFTQSxHQUFhQSxJQUFJQSxxQkFBU0EsQ0FBQ0EsRUFBQ0EsTUFBQUEsSUFBSUEsRUFBRUEsU0FBQUEsT0FBT0EsRUFBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDekRBLEtBQUlBLENBQUNBLE9BQU9BLENBQUNBLGNBQWNBLENBQUNBLFNBQVNBLEVBQUVBLFVBQUNBLE1BQWFBO2dCQUNqREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2ZBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLDRCQUE0QkEsQ0FBQ0EsQ0FBQ0E7b0JBQzVDQSxNQUFNQSxDQUFDQTtnQkFDWEEsQ0FBQ0E7Z0JBRURBLFFBQVFBLENBQUNBLEtBQUlBLENBQUNBLGVBQWVBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQzlDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNQQSxDQUFDQSxDQUFBQTtJQUNMQSxDQUFDQTtJQUVNSCxvQ0FBZUEsR0FBdEJBLFVBQXVCQSxTQUFtQkE7UUFDdENJLE1BQU1BLENBQUNBLEVBQUNBLElBQUlBLEVBQUVBLGdCQUFRQSxFQUFFQSxTQUFTQSxFQUFFQSxTQUFTQSxFQUFDQSxDQUFDQTtJQUNsREEsQ0FBQ0E7SUFFTUosc0NBQWlCQSxHQUF4QkE7UUFDSUssTUFBTUEsQ0FBQ0EsRUFBQ0EsSUFBSUEsRUFBRUEsbUJBQVdBLEVBQUNBLENBQUNBO0lBQy9CQSxDQUFDQTtJQUVNTCwrQkFBVUEsR0FBakJBLFVBQWtCQSxTQUFtQkE7UUFBckNNLGlCQVdDQTtRQVZHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEVBQUVBLENBQUNBO1FBQzFCQSxNQUFNQSxDQUFDQSxVQUFDQSxRQUFRQTtZQUNaQSxLQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFNBQVNBLEVBQUVBLFVBQUNBLE1BQWFBO2dCQUNuREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2ZBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLDRCQUE0QkEsQ0FBQ0EsQ0FBQ0E7b0JBQzVDQSxNQUFNQSxDQUFDQTtnQkFDWEEsQ0FBQ0E7Z0JBQ0RBLFFBQVFBLENBQUNBLEtBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDakRBLENBQUNBLENBQUNBLENBQUNBO1FBQ1BBLENBQUNBLENBQUFBO0lBQ0xBLENBQUNBO0lBRU1OLHVDQUFrQkEsR0FBekJBLFVBQTBCQSxTQUFtQkE7UUFDekNPLE1BQU1BLENBQUNBLEVBQUNBLElBQUlBLEVBQUVBLG1CQUFXQSxFQUFFQSxPQUFPQSxFQUFFQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxFQUFDQSxDQUFDQTtJQUNyRUEsQ0FBQ0E7SUFFTVAsNkJBQVFBLEdBQWZBLFVBQWdCQSxTQUFtQkE7UUFBbkNRLGlCQVdDQTtRQVZHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEVBQUVBLENBQUNBO1FBQzFCQSxNQUFNQSxDQUFDQSxVQUFDQSxRQUFRQTtZQUNaQSxRQUFRQSxDQUFDQSxLQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQzNDQSxLQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxjQUFjQSxDQUFDQSxTQUFTQSxFQUFFQSxVQUFDQSxNQUFhQTtnQkFDakRBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO29CQUNmQSxPQUFPQSxDQUFDQSxLQUFLQSxDQUFDQSw0QkFBNEJBLENBQUNBLENBQUNBO29CQUM1Q0EsTUFBTUEsQ0FBQ0E7Z0JBQ1hBLENBQUNBO1lBQ0xBLENBQUNBLENBQUNBLENBQUNBO1FBQ1BBLENBQUNBLENBQUFBO0lBQ0xBLENBQUNBO0lBRU1SLHFDQUFnQkEsR0FBdkJBLFVBQXdCQSxTQUFtQkE7UUFDdkNTLE1BQU1BLENBQUNBLEVBQUNBLElBQUlBLEVBQUVBLGlCQUFTQSxFQUFFQSxPQUFPQSxFQUFFQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxNQUFNQSxFQUFFQSxLQUFLQSxFQUFFQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQSxFQUFDQSxDQUFDQTtJQUMxR0EsQ0FBQ0E7SUFqSExUO1FBQUNBLGlCQUFVQSxFQUFFQTs7bUJBbUhaQTtJQUFEQSxpQkFBQ0E7QUFBREEsQ0FuSEEsQUFtSENBLEVBbEgrQiw2QkFBTyxFQWtIdEM7QUFsSFksa0JBQVUsYUFrSHRCLENBQUEiLCJmaWxlIjoiY29tcHMvYXBwMS90b2Rvcy9hY3Rpb25zL1RvZG9BY3Rpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGFibGUsIENvbXBvbmVudCwgSW5qZWN0b3IsIHByb3ZpZGV9IGZyb20gXCJhbmd1bGFyMi9jb3JlXCI7XHJcbmltcG9ydCB7QWN0aW9ucywgQXBwU3RvcmV9IGZyb20gXCJhbmd1bGFyMi1yZWR1eC11dGlsXCI7XHJcbmltcG9ydCB7VG9kb01vZGVsfSBmcm9tIFwiLi4vVG9kb01vZGVsXCI7XHJcbmltcG9ydCB7U3RvcmVNb2RlbH0gZnJvbSBcIi4uLy4uLy4uLy4uL21vZGVscy9TdG9yZU1vZGVsXCI7XHJcbmltcG9ydCB7VG9kb1NlcnZpY2V9IGZyb20gXCIuLi9Ub2RvU2VydmljZVwiO1xyXG5pbXBvcnQge0hUVFBfUFJPVklERVJTfSBmcm9tIFwiYW5ndWxhcjIvaHR0cFwiO1xyXG5pbXBvcnQgVG9kb1N0YXRzTW9kZWwgZnJvbSBcIi4uL1RvZG9TdGF0c01vZGVsXCI7XHJcbmltcG9ydCB7Q29tbUJyb2tlcn0gZnJvbSBcIi4uLy4uLy4uLy4uL3NlcnZpY2VzL0NvbW1Ccm9rZXJcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBBRERfVE9ETyA9ICdBRERfVE9ETyc7XHJcbmV4cG9ydCBjb25zdCBSRU1PVkVfVE9ETyA9ICdSRU1PVkVfVE9ETyc7XHJcbmV4cG9ydCBjb25zdCBFRElUX1RPRE8gPSAnRURJVF9UT0RPJztcclxuZXhwb3J0IGNvbnN0IENMRUFSX1RPRE9TID0gJ0NMRUFSX1RPRE9TJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFRvZG9BY3Rpb24gZXh0ZW5kcyBBY3Rpb25zIHtcclxuXHJcbiAgICBwcml2YXRlIHNlcnZpY2U6VG9kb1NlcnZpY2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhcHBTdG9yZTpBcHBTdG9yZSkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmYWN0b3J5VG9kb1NlcnZpY2UoKTpUb2RvU2VydmljZSB7XHJcblxyXG5cclxuICAgICAgICAvKiogQW4gZXhhbXBsZSBvZiBob3cgdG8gcHJvdmlkZSBhIHNlcnZpY2UgbWFudWFsbHkgdGhhdCBkZXBlbmRzIG9uIG90aGVyIHNlcnZpY2VzXHJcbiAgICAgICAgIGFzIHdlbGwgYXMgZXhhbXBsZSBvZiBmYWN0b3J5LCB1c2UgcHJvdmlkZXJzOiBbIC4uLiB3aGVuIGluc2lkZSBhIGNvbXBvbmVudFxyXG4gICAgICAgICBvciB2aWEgYSBwdXJlIHByb3ZpZGUoLi4uIGlmIG5vdCFcclxuXHJcbiAgICAgICAgIHdoaWxlIHRoaXMgbWF5IG5vdCBiZSB0aGUgYmVzdCB3YXkgdG8gYXJjaGl0ZWN0IHlvdXIgYXBwbGljYXRpb24sIHdlIHN0aWxsIHVzZVxyXG4gICAgICAgICBpdCBoZXJlIGFzIGNvZGUgc2FtcGxlOlxyXG5cclxuICAgICAgICAgZXhhbXBsZXMgMSB2aWEgY29tcG9uZW50IGRlY29yYXRpb246XHJcbiAgICAgICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgICAgICBwcm92aWRlcnM6IFtcclxuICAgICAgICAgcHJvdmlkZShUb2RvU2VydmljZSwge1xyXG4gICAgICAgICAgICAgICAgdXNlRmFjdG9yeTogKHRvZG9BY3Rpb24sIGh0dHAsIHRvZG9TdGF0c01vZGVsLCBhcHBTdG9yZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgdG9kb0FjdGlvbihUb2RvQWN0aW9uLCBodHRwLCB0b2RvU3RhdHNNb2RlbCwgYXBwU3RvcmUpXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZGVwczogW1RvZG9BY3Rpb24sIEh0dHAsIFRvZG9TdGF0c01vZGVsLCBBcHBTdG9yZV1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgXVxyXG5cclxuICAgICAgICAgZXhhbXBsZXMgMiBpbiBjb250cm9sbGVyXHJcbiAgICAgICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgICAgICB2YXIgcCA9IHByb3ZpZGUoVG9kb1NlcnZpY2UsIHtcclxuICAgICAgICAgICAgdXNlRmFjdG9yeTogKHRvZG9BY3Rpb24sIGh0dHAsIHRvZG9TdGF0c01vZGVsLCBhcHBTdG9yZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyB0b2RvQWN0aW9uKFRvZG9BY3Rpb24sIGh0dHAsIHRvZG9TdGF0c01vZGVsLCBhcHBTdG9yZSlcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZGVwczogW1RvZG9BY3Rpb24sIEhUVFBfUFJPVklERVJTLCBUb2RvU3RhdHNNb2RlbCwgQXBwU3RvcmVdXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgIGV4YW1wbGVzIDMgaW4gY29udHJvbGxlclxyXG4gICAgICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAgICAgICAgKiovXHJcbiAgICAgICAgaWYgKHRoaXMuc2VydmljZSlcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VydmljZTtcclxuXHJcbiAgICAgICAgdmFyIGluamVjdG9yID0gSW5qZWN0b3IucmVzb2x2ZUFuZENyZWF0ZShcclxuICAgICAgICAgICAgW1xyXG4gICAgICAgICAgICAgICAgVG9kb1NlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBUb2RvQWN0aW9uLFxyXG4gICAgICAgICAgICAgICAgSFRUUF9QUk9WSURFUlMsXHJcbiAgICAgICAgICAgICAgICBUb2RvU3RhdHNNb2RlbCxcclxuICAgICAgICAgICAgICAgIHByb3ZpZGUoQ29tbUJyb2tlciwge3VzZUNsYXNzOiBDb21tQnJva2VyfSksXHJcbiAgICAgICAgICAgICAgICBwcm92aWRlKEFwcFN0b3JlLCB7dXNlVmFsdWU6IHRoaXMuYXBwU3RvcmV9KVxyXG4gICAgICAgICAgICBdKTtcclxuICAgICAgICB0aGlzLnNlcnZpY2UgPSBpbmplY3Rvci5nZXQoVG9kb1NlcnZpY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRUb2RvKHRhc2s6c3RyaW5nLCBpZD86c3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5mYWN0b3J5VG9kb1NlcnZpY2UoKTtcclxuICAgICAgICByZXR1cm4gKGRpc3BhdGNoKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBtb2RlbElkID0gaWQgfHwgU3RvcmVNb2RlbC5VbmlxdWVJZCgpO1xyXG4gICAgICAgICAgICB2YXIgdG9kb01vZGVsOlRvZG9Nb2RlbCA9IG5ldyBUb2RvTW9kZWwoe3Rhc2ssIG1vZGVsSWR9KTtcclxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLnNhdmVUb2RvUmVtb3RlKHRvZG9Nb2RlbCwgKHN0YXR1czpudW1iZXIpPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvb3Rib3guYWxlcnQoJ3Byb2JsZW0gc2F2aW5nIHRvIHNlcnZlciAxJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9kaXNwYXRjaCh7dHlwZTogQUREX1RPRE8sIHRvZG9Nb2RlbDogdG9kb01vZGVsfSk7XHJcbiAgICAgICAgICAgICAgICBkaXNwYXRjaCh0aGlzLmFkZFRvZG9EaXNwYXRjaCh0b2RvTW9kZWwpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRUb2RvRGlzcGF0Y2godG9kb01vZGVsOlRvZG9Nb2RlbCkge1xyXG4gICAgICAgIHJldHVybiB7dHlwZTogQUREX1RPRE8sIHRvZG9Nb2RlbDogdG9kb01vZGVsfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xlYXJUb2RvRGlzcGF0Y2goKSB7XHJcbiAgICAgICAgcmV0dXJuIHt0eXBlOiBDTEVBUl9UT0RPU307XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlbW92ZVRvZG8odG9kb01vZGVsOlRvZG9Nb2RlbCkge1xyXG4gICAgICAgIHRoaXMuZmFjdG9yeVRvZG9TZXJ2aWNlKCk7XHJcbiAgICAgICAgcmV0dXJuIChkaXNwYXRjaCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlcnZpY2UucmVtb3ZlVG9kb1JlbW90ZSh0b2RvTW9kZWwsIChzdGF0dXM6bnVtYmVyKT0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBib290Ym94LmFsZXJ0KCdwcm9ibGVtIHNhdmluZyB0byBzZXJ2ZXIgMicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRpc3BhdGNoKHRoaXMucmVtb3ZlVG9kb0Rpc3BhdGNoKHRvZG9Nb2RlbCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlbW92ZVRvZG9EaXNwYXRjaCh0b2RvTW9kZWw6VG9kb01vZGVsKSB7XHJcbiAgICAgICAgcmV0dXJuIHt0eXBlOiBSRU1PVkVfVE9ETywgbW9kZWxJZDogdG9kb01vZGVsLmdldEtleSgnbW9kZWxJZCcpfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZWRpdFRvZG8odG9kb01vZGVsOlRvZG9Nb2RlbCkge1xyXG4gICAgICAgIHRoaXMuZmFjdG9yeVRvZG9TZXJ2aWNlKCk7XHJcbiAgICAgICAgcmV0dXJuIChkaXNwYXRjaCkgPT4ge1xyXG4gICAgICAgICAgICBkaXNwYXRjaCh0aGlzLmVkaXRUb2RvRGlzcGF0Y2godG9kb01vZGVsKSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VydmljZS5lZGl0VG9kb1JlbW90ZSh0b2RvTW9kZWwsIChzdGF0dXM6bnVtYmVyKT0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBib290Ym94LmFsZXJ0KCdwcm9ibGVtIHNhdmluZyB0byBzZXJ2ZXIgMycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBlZGl0VG9kb0Rpc3BhdGNoKHRvZG9Nb2RlbDpUb2RvTW9kZWwpIHtcclxuICAgICAgICByZXR1cm4ge3R5cGU6IEVESVRfVE9ETywgbW9kZWxJZDogdG9kb01vZGVsLmdldEtleSgnbW9kZWxJZCcpLCBrZXk6ICd0YXNrJywgdmFsdWU6IHRvZG9Nb2RlbFsndGFzayddfTtcclxuICAgIH1cclxuXHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
