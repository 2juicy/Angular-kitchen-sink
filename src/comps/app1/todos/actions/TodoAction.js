var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("angular2/core");
var angular2_redux_util_1 = require("angular2-redux-util");
var TodoModel_1 = require("../TodoModel");
var StoreModel_1 = require("../../../../models/StoreModel");
var TodoService_1 = require("../TodoService");
var http_1 = require("angular2/http");
var TodoStatsModel_1 = require("../TodoStatsModel");
var CommBroker_1 = require("../../../../services/CommBroker");
exports.ADD_TODO = 'ADD_TODO';
exports.REMOVE_TODO = 'REMOVE_TODO';
exports.EDIT_TODO = 'EDIT_TODO';
exports.CLEAR_TODOS = 'CLEAR_TODOS';
var bootbox = require('bootbox');
var TodoAction = (function (_super) {
    __extends(TodoAction, _super);
    function TodoAction(appStore) {
        _super.call(this);
        this.appStore = appStore;
    }
    TodoAction.prototype.factoryTodoService = function () {
        if (this.service)
            return this.service;
        var injector = core_1.Injector.resolveAndCreate([
            TodoService_1.TodoService,
            TodoAction,
            http_1.HTTP_PROVIDERS,
            TodoStatsModel_1.default,
            core_1.provide(CommBroker_1.CommBroker, { useClass: CommBroker_1.CommBroker }),
            core_1.provide(angular2_redux_util_1.AppStore, { useValue: this.appStore })
        ]);
        this.service = injector.get(TodoService_1.TodoService);
        return this.service;
    };
    TodoAction.prototype.addTodo = function (task, id) {
        var _this = this;
        this.factoryTodoService();
        return function (dispatch) {
            var modelId = id || StoreModel_1.StoreModel.UniqueId();
            var todoModel = new TodoModel_1.TodoModel({ task: task, modelId: modelId });
            _this.service.saveTodoRemote(todoModel, function (status) {
                if (status == -1) {
                    bootbox.alert('problem saving to server 1');
                    return;
                }
                dispatch(_this.addTodoDispatch(todoModel));
            });
        };
    };
    TodoAction.prototype.addTodoDispatch = function (todoModel) {
        return { type: exports.ADD_TODO, todoModel: todoModel };
    };
    TodoAction.prototype.clearTodoDispatch = function () {
        return { type: exports.CLEAR_TODOS };
    };
    TodoAction.prototype.removeTodo = function (todoModel) {
        var _this = this;
        this.factoryTodoService();
        return function (dispatch) {
            _this.service.removeTodoRemote(todoModel, function (status) {
                if (status == -1) {
                    bootbox.alert('problem saving to server 2');
                    return;
                }
                dispatch(_this.removeTodoDispatch(todoModel));
            });
        };
    };
    TodoAction.prototype.removeTodoDispatch = function (todoModel) {
        return { type: exports.REMOVE_TODO, modelId: todoModel.getKey('modelId') };
    };
    TodoAction.prototype.editTodo = function (todoModel) {
        var _this = this;
        this.factoryTodoService();
        return function (dispatch) {
            dispatch(_this.editTodoDispatch(todoModel));
            _this.service.editTodoRemote(todoModel, function (status) {
                if (status == -1) {
                    bootbox.alert('problem saving to server 3');
                    return;
                }
            });
        };
    };
    TodoAction.prototype.editTodoDispatch = function (todoModel) {
        return { type: exports.EDIT_TODO, modelId: todoModel.getKey('modelId'), key: 'task', value: todoModel['task'] };
    };
    TodoAction = __decorate([
        core_1.Injectable(), 
        __metadata('design:paramtypes', [angular2_redux_util_1.AppStore])
    ], TodoAction);
    return TodoAction;
})(angular2_redux_util_1.Actions);
exports.TodoAction = TodoAction;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBzL2FwcDEvdG9kb3MvYWN0aW9ucy90b2RvYWN0aW9uLnRzIl0sIm5hbWVzIjpbIlRvZG9BY3Rpb24iLCJUb2RvQWN0aW9uLmNvbnN0cnVjdG9yIiwiVG9kb0FjdGlvbi5mYWN0b3J5VG9kb1NlcnZpY2UiLCJUb2RvQWN0aW9uLmFkZFRvZG8iLCJUb2RvQWN0aW9uLmFkZFRvZG9EaXNwYXRjaCIsIlRvZG9BY3Rpb24uY2xlYXJUb2RvRGlzcGF0Y2giLCJUb2RvQWN0aW9uLnJlbW92ZVRvZG8iLCJUb2RvQWN0aW9uLnJlbW92ZVRvZG9EaXNwYXRjaCIsIlRvZG9BY3Rpb24uZWRpdFRvZG8iLCJUb2RvQWN0aW9uLmVkaXRUb2RvRGlzcGF0Y2giXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEscUJBQXVELGVBQWUsQ0FBQyxDQUFBO0FBQ3ZFLG9DQUFnQyxxQkFBcUIsQ0FBQyxDQUFBO0FBQ3RELDBCQUF3QixjQUFjLENBQUMsQ0FBQTtBQUN2QywyQkFBeUIsK0JBQStCLENBQUMsQ0FBQTtBQUN6RCw0QkFBMEIsZ0JBQWdCLENBQUMsQ0FBQTtBQUMzQyxxQkFBNkIsZUFBZSxDQUFDLENBQUE7QUFDN0MsK0JBQTJCLG1CQUFtQixDQUFDLENBQUE7QUFDL0MsMkJBQXlCLGlDQUFpQyxDQUFDLENBQUE7QUFFOUMsZ0JBQVEsR0FBRyxVQUFVLENBQUM7QUFDdEIsbUJBQVcsR0FBRyxhQUFhLENBQUM7QUFDNUIsaUJBQVMsR0FBRyxXQUFXLENBQUM7QUFDeEIsbUJBQVcsR0FBRyxhQUFhLENBQUM7QUFFekMsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBRWpDO0lBQ2dDQSw4QkFBT0E7SUFJbkNBLG9CQUFvQkEsUUFBaUJBO1FBQ2pDQyxpQkFBT0EsQ0FBQ0E7UUFEUUEsYUFBUUEsR0FBUkEsUUFBUUEsQ0FBU0E7SUFFckNBLENBQUNBO0lBRU9ELHVDQUFrQkEsR0FBMUJBO1FBaUNJRSxFQUFFQSxDQUFDQSxDQUFDQSxJ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QW5IWSxrQkFBVSxhQW1IdEIsQ0FBQSIsImZpbGUiOiJjb21wcy9hcHAxL3RvZG9zL2FjdGlvbnMvVG9kb0FjdGlvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SW5qZWN0YWJsZSwgQ29tcG9uZW50LCBJbmplY3RvciwgcHJvdmlkZX0gZnJvbSBcImFuZ3VsYXIyL2NvcmVcIjtcclxuaW1wb3J0IHtBY3Rpb25zLCBBcHBTdG9yZX0gZnJvbSBcImFuZ3VsYXIyLXJlZHV4LXV0aWxcIjtcclxuaW1wb3J0IHtUb2RvTW9kZWx9IGZyb20gXCIuLi9Ub2RvTW9kZWxcIjtcclxuaW1wb3J0IHtTdG9yZU1vZGVsfSBmcm9tIFwiLi4vLi4vLi4vLi4vbW9kZWxzL1N0b3JlTW9kZWxcIjtcclxuaW1wb3J0IHtUb2RvU2VydmljZX0gZnJvbSBcIi4uL1RvZG9TZXJ2aWNlXCI7XHJcbmltcG9ydCB7SFRUUF9QUk9WSURFUlN9IGZyb20gXCJhbmd1bGFyMi9odHRwXCI7XHJcbmltcG9ydCBUb2RvU3RhdHNNb2RlbCBmcm9tIFwiLi4vVG9kb1N0YXRzTW9kZWxcIjtcclxuaW1wb3J0IHtDb21tQnJva2VyfSBmcm9tIFwiLi4vLi4vLi4vLi4vc2VydmljZXMvQ29tbUJyb2tlclwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IEFERF9UT0RPID0gJ0FERF9UT0RPJztcclxuZXhwb3J0IGNvbnN0IFJFTU9WRV9UT0RPID0gJ1JFTU9WRV9UT0RPJztcclxuZXhwb3J0IGNvbnN0IEVESVRfVE9ETyA9ICdFRElUX1RPRE8nO1xyXG5leHBvcnQgY29uc3QgQ0xFQVJfVE9ET1MgPSAnQ0xFQVJfVE9ET1MnO1xyXG5cclxudmFyIGJvb3Rib3ggPSByZXF1aXJlKCdib290Ym94Jyk7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBUb2RvQWN0aW9uIGV4dGVuZHMgQWN0aW9ucyB7XHJcblxyXG4gICAgcHJpdmF0ZSBzZXJ2aWNlOlRvZG9TZXJ2aWNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBwU3RvcmU6QXBwU3RvcmUpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZmFjdG9yeVRvZG9TZXJ2aWNlKCk6VG9kb1NlcnZpY2Uge1xyXG5cclxuXHJcbiAgICAgICAgLyoqIEFuIGV4YW1wbGUgb2YgaG93IHRvIHByb3ZpZGUgYSBzZXJ2aWNlIG1hbnVhbGx5IHRoYXQgZGVwZW5kcyBvbiBvdGhlciBzZXJ2aWNlc1xyXG4gICAgICAgICBhcyB3ZWxsIGFzIGV4YW1wbGUgb2YgZmFjdG9yeSwgdXNlIHByb3ZpZGVyczogWyAuLi4gd2hlbiBpbnNpZGUgYSBjb21wb25lbnRcclxuICAgICAgICAgb3IgdmlhIGEgcHVyZSBwcm92aWRlKC4uLiBpZiBub3QhXHJcblxyXG4gICAgICAgICB3aGlsZSB0aGlzIG1heSBub3QgYmUgdGhlIGJlc3Qgd2F5IHRvIGFyY2hpdGVjdCB5b3VyIGFwcGxpY2F0aW9uLCB3ZSBzdGlsbCB1c2VcclxuICAgICAgICAgaXQgaGVyZSBhcyBjb2RlIHNhbXBsZTpcclxuXHJcbiAgICAgICAgIGV4YW1wbGVzIDEgdmlhIGNvbXBvbmVudCBkZWNvcmF0aW9uOlxyXG4gICAgICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAgICAgICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAgIHByb3ZpZGUoVG9kb1NlcnZpY2UsIHtcclxuICAgICAgICAgICAgICAgIHVzZUZhY3Rvcnk6ICh0b2RvQWN0aW9uLCBodHRwLCB0b2RvU3RhdHNNb2RlbCwgYXBwU3RvcmUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHRvZG9BY3Rpb24oVG9kb0FjdGlvbiwgaHR0cCwgdG9kb1N0YXRzTW9kZWwsIGFwcFN0b3JlKVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGRlcHM6IFtUb2RvQWN0aW9uLCBIdHRwLCBUb2RvU3RhdHNNb2RlbCwgQXBwU3RvcmVdXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgIF1cclxuXHJcbiAgICAgICAgIGV4YW1wbGVzIDIgaW4gY29udHJvbGxlclxyXG4gICAgICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAgICAgICAgdmFyIHAgPSBwcm92aWRlKFRvZG9TZXJ2aWNlLCB7XHJcbiAgICAgICAgICAgIHVzZUZhY3Rvcnk6ICh0b2RvQWN0aW9uLCBodHRwLCB0b2RvU3RhdHNNb2RlbCwgYXBwU3RvcmUpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgdG9kb0FjdGlvbihUb2RvQWN0aW9uLCBodHRwLCB0b2RvU3RhdHNNb2RlbCwgYXBwU3RvcmUpXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGRlcHM6IFtUb2RvQWN0aW9uLCBIVFRQX1BST1ZJREVSUywgVG9kb1N0YXRzTW9kZWwsIEFwcFN0b3JlXVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgICBleGFtcGxlcyAzIGluIGNvbnRyb2xsZXJcclxuICAgICAgICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgICAgICAgICoqL1xyXG4gICAgICAgIGlmICh0aGlzLnNlcnZpY2UpXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2U7XHJcblxyXG4gICAgICAgIHZhciBpbmplY3RvciA9IEluamVjdG9yLnJlc29sdmVBbmRDcmVhdGUoXHJcbiAgICAgICAgICAgIFtcclxuICAgICAgICAgICAgICAgIFRvZG9TZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgVG9kb0FjdGlvbixcclxuICAgICAgICAgICAgICAgIEhUVFBfUFJPVklERVJTLFxyXG4gICAgICAgICAgICAgICAgVG9kb1N0YXRzTW9kZWwsXHJcbiAgICAgICAgICAgICAgICBwcm92aWRlKENvbW1Ccm9rZXIsIHt1c2VDbGFzczogQ29tbUJyb2tlcn0pLFxyXG4gICAgICAgICAgICAgICAgcHJvdmlkZShBcHBTdG9yZSwge3VzZVZhbHVlOiB0aGlzLmFwcFN0b3JlfSlcclxuICAgICAgICAgICAgXSk7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gaW5qZWN0b3IuZ2V0KFRvZG9TZXJ2aWNlKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRUb2RvKHRhc2s6c3RyaW5nLCBpZD86c3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5mYWN0b3J5VG9kb1NlcnZpY2UoKTtcclxuICAgICAgICByZXR1cm4gKGRpc3BhdGNoKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBtb2RlbElkID0gaWQgfHwgU3RvcmVNb2RlbC5VbmlxdWVJZCgpO1xyXG4gICAgICAgICAgICB2YXIgdG9kb01vZGVsOlRvZG9Nb2RlbCA9IG5ldyBUb2RvTW9kZWwoe3Rhc2ssIG1vZGVsSWR9KTtcclxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLnNhdmVUb2RvUmVtb3RlKHRvZG9Nb2RlbCwgKHN0YXR1czpudW1iZXIpPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvb3Rib3guYWxlcnQoJ3Byb2JsZW0gc2F2aW5nIHRvIHNlcnZlciAxJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9kaXNwYXRjaCh7dHlwZTogQUREX1RPRE8sIHRvZG9Nb2RlbDogdG9kb01vZGVsfSk7XHJcbiAgICAgICAgICAgICAgICBkaXNwYXRjaCh0aGlzLmFkZFRvZG9EaXNwYXRjaCh0b2RvTW9kZWwpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRUb2RvRGlzcGF0Y2godG9kb01vZGVsOlRvZG9Nb2RlbCkge1xyXG4gICAgICAgIHJldHVybiB7dHlwZTogQUREX1RPRE8sIHRvZG9Nb2RlbDogdG9kb01vZGVsfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xlYXJUb2RvRGlzcGF0Y2goKSB7XHJcbiAgICAgICAgcmV0dXJuIHt0eXBlOiBDTEVBUl9UT0RPU307XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlbW92ZVRvZG8odG9kb01vZGVsOlRvZG9Nb2RlbCkge1xyXG4gICAgICAgIHRoaXMuZmFjdG9yeVRvZG9TZXJ2aWNlKCk7XHJcbiAgICAgICAgcmV0dXJuIChkaXNwYXRjaCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlcnZpY2UucmVtb3ZlVG9kb1JlbW90ZSh0b2RvTW9kZWwsIChzdGF0dXM6bnVtYmVyKT0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBib290Ym94LmFsZXJ0KCdwcm9ibGVtIHNhdmluZyB0byBzZXJ2ZXIgMicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRpc3BhdGNoKHRoaXMucmVtb3ZlVG9kb0Rpc3BhdGNoKHRvZG9Nb2RlbCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlbW92ZVRvZG9EaXNwYXRjaCh0b2RvTW9kZWw6VG9kb01vZGVsKSB7XHJcbiAgICAgICAgcmV0dXJuIHt0eXBlOiBSRU1PVkVfVE9ETywgbW9kZWxJZDogdG9kb01vZGVsLmdldEtleSgnbW9kZWxJZCcpfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZWRpdFRvZG8odG9kb01vZGVsOlRvZG9Nb2RlbCkge1xyXG4gICAgICAgIHRoaXMuZmFjdG9yeVRvZG9TZXJ2aWNlKCk7XHJcbiAgICAgICAgcmV0dXJuIChkaXNwYXRjaCkgPT4ge1xyXG4gICAgICAgICAgICBkaXNwYXRjaCh0aGlzLmVkaXRUb2RvRGlzcGF0Y2godG9kb01vZGVsKSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VydmljZS5lZGl0VG9kb1JlbW90ZSh0b2RvTW9kZWwsIChzdGF0dXM6bnVtYmVyKT0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBib290Ym94LmFsZXJ0KCdwcm9ibGVtIHNhdmluZyB0byBzZXJ2ZXIgMycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBlZGl0VG9kb0Rpc3BhdGNoKHRvZG9Nb2RlbDpUb2RvTW9kZWwpIHtcclxuICAgICAgICByZXR1cm4ge3R5cGU6IEVESVRfVE9ETywgbW9kZWxJZDogdG9kb01vZGVsLmdldEtleSgnbW9kZWxJZCcpLCBrZXk6ICd0YXNrJywgdmFsdWU6IHRvZG9Nb2RlbFsndGFzayddfTtcclxuICAgIH1cclxuXHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
