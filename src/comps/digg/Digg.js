var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('angular2/core');
var browser_1 = require('angular2/platform/browser');
var Conts_1 = require("../../../src/Conts");
var Observable_1 = require("rxjs/Observable");
var DiggLoader_1 = require("../../../src/comps/digg/DiggLoader");
var CommBroker_1 = require("../../services/CommBroker");
require('rxjs/add/observable/from');
require('rxjs/add/operator/do');
require('rxjs/add/operator/debounceTime');
require('rxjs/add/operator/distinctUntilChanged');
var DIGG_INIT_HEIGHT = '400px';
var Digg = (function () {
    function Digg(commBroker, diggLoader, m_commBroker, viewContainer) {
        this.commBroker = commBroker;
        this.m_commBroker = m_commBroker;
        this.dom = new browser_1.BrowserDomAdapter();
        var self = this;
        self.mode = 'list';
        this.diggs = [];
        self.viewContainer = viewContainer;
        self.el = viewContainer.element.nativeElement;
        self.channel = new Observable_1.Observable(function (observer) {
            self.stream = observer;
        }).share();
        self.channel.debounceTime(1000).distinctUntilChanged().subscribe(function (e) {
            self.diggs = [];
            diggLoader.loadDiggs(e, self.diggs);
        });
        this.listenWinResize();
        var propView = this.commBroker.getService(Conts_1.Consts.Services().Properties);
        if (propView)
            propView.setPropView('Digg');
    }
    Digg.prototype.ngOnInit = function () {
    };
    Digg.prototype.listenWinResize = function () {
        var self = this;
        self.m_commBroker.onEvent(Conts_1.Consts.Events().WIN_SIZED).subscribe(function (e) {
            self.setSize(e.message.height);
        });
    };
    Digg.prototype.ngAfterContentInit = function () {
        this.tileStyle = this.mode == "tiles" ? true : false;
        this.setSize(this.m_commBroker.getValue(Conts_1.Consts.Values().APP_SIZE).height);
    };
    Digg.prototype.setSize = function (height) {
        var h = height - 200;
        var el = this.dom.getElementsByClassName(this.el, 'diggContainer')[0];
        this.dom.setStyle(el, 'height', h);
    };
    Digg.prototype.onSearch = function (event) {
        this.stream.next(event.target.value);
    };
    Digg = __decorate([
        core_1.Component({
            selector: 'Digg',
            inputs: ['mode:mode'],
            encapsulation: core_1.ViewEncapsulation.Emulated,
            providers: [DiggLoader_1.DiggLoader],
            styles: [("\n        .diggContainer {\n            overflow-y: scroll;\n            height: " + DIGG_INIT_HEIGHT + ";\n        };\n        .largeImage {\n           max-width: 100;\n           max-height: 60;\n        }\n        .smallImage {\n           width: 70;\n           height: 40;\n        }\n        .grow { transition: all .2s ease-in-out; }\n        .grow:hover { transform: scale(1.1); opacity: 0.7}\n    ")],
            template: "\n        <ng-content></ng-content>\n        <div class=\"appHeight\">\n             <form (submit)=\"$event.preventDefault();\">\n                <br/>\n                <div class=\"input-group\">\n                      <span class=\"input-group-addon\" id=\"symbol-input\">Digg filter</span>\n                      <input type=\"text\" class=\"form-control\" (keyup)=\"onSearch($event)\" placeholder=\"press [ENTER] for unfiltered result\">\n                    </div>\n              </form>\n              <div class=\"diggContainer list\">\n                  <table class=\"table table-striped\">\n                  <tbody>\n                    <tr *ngFor=\"#digg of diggs\" [ngClass]=\"{'col-xs-4': tileStyle, 'col-lg-3': tileStyle}\">\n                      <td>\n                      <img class=\"img-responsive grow\" [ngClass]=\"{'largeImage': tileStyle, 'smallImage': !tileStyle}\" src=\"{{digg.link}}\"/>\n                      <span>{{digg.title}}</span>\n                      </td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n        </div>\n  "
        }), 
        __metadata('design:paramtypes', [CommBroker_1.CommBroker, DiggLoader_1.DiggLoader, CommBroker_1.CommBroker, core_1.ViewContainerRef])
    ], Digg);
    return Digg;
})();
exports.Digg = Digg;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBzL2RpZ2cvZGlnZy50cyJdLCJuYW1lcyI6WyJEaWdnIiwiRGlnZy5jb25zdHJ1Y3RvciIsIkRpZ2cubmdPbkluaXQiLCJEaWdnLmxpc3RlbldpblJlc2l6ZSIsIkRpZ2cubmdBZnRlckNvbnRlbnRJbml0IiwiRGlnZy5zZXRTaXplIiwiRGlnZy5vblNlYXJjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBWUEscUJBQTZELGVBQWUsQ0FBQyxDQUFBO0FBQzdFLHdCQUFnQywyQkFBMkIsQ0FBQyxDQUFBO0FBQzVELHNCQUFxQixvQkFBb0IsQ0FBQyxDQUFBO0FBQzFDLDJCQUF5QixpQkFBaUIsQ0FBQyxDQUFBO0FBQzNDLDJCQUF5QixvQ0FBb0MsQ0FBQyxDQUFBO0FBRzlELDJCQUFtQywyQkFBMkIsQ0FBQyxDQUFBO0FBQy9ELFFBQU8sMEJBQTBCLENBQUMsQ0FBQTtBQUNsQyxRQUFPLHNCQUFzQixDQUFDLENBQUE7QUFDOUIsUUFBTyxnQ0FBZ0MsQ0FBQyxDQUFBO0FBQ3hDLFFBQU8sd0NBQXdDLENBQUMsQ0FBQTtBQUdoRCxJQUFNLGdCQUFnQixHQUFHLE9BQU8sQ0FBQztBQUVqQztJQXlESUEsY0FBb0JBLFVBQXFCQSxFQUFFQSxVQUFxQkEsRUFBVUEsWUFBdUJBLEVBQUVBLGFBQThCQTtRQUE3R0MsZUFBVUEsR0FBVkEsVUFBVUEsQ0FBV0E7UUFBaUNBLGlCQUFZQSxHQUFaQSxZQUFZQSxDQUFXQTtRQUZ6RkEsUUFBR0EsR0FBR0EsSUFBSUEsMkJBQWlCQSxFQUFFQSxDQUFDQTtRQUdsQ0EsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDaEJBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLE1BQU1BLENBQUNBO1FBQ25CQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNoQkEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsYUFBYUEsQ0FBQ0E7UUFDbkNBLElBQUlBLENBQUNBLEVBQUVBLEdBQUdBLGFBQWFBLENB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U0FBU0EsRUFBRUEsQ0FBQ0EsdUJBQVVBLENBQUNBO1lBQ3ZCQSxNQUFNQSxFQUFFQSxDQUFDQSx1RkFHU0EsZ0JBQWdCQSxvVEFZakNBLENBQUNBO1lBQ0ZBLFFBQVFBLEVBQUVBLGltQ0F1QlhBO1NBQ0ZBLENBQUNBOzthQTJEREE7SUFBREEsV0FBQ0E7QUFBREEsQ0F4R0EsQUF3R0NBLElBQUE7QUF6RFksWUFBSSxPQXlEaEIsQ0FBQSIsImZpbGUiOiJjb21wcy9kaWdnL0RpZ2cuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gbmcyQm9pbGVycGxhdGUgYXBwbGljYXRpb25cclxuXHJcbiBHZXQgdXAgYW5kIHJ1bm5pbmcgcXVpY2tseSB3aXRoIGEgd29ya2luZ1xyXG4gYXBwbGljYXRpb24gd2l0aCBzb2xpZCBmb3VuZGF0aW9uIGZvclxyXG4gR29vZ2xlJ3MgQW5ndWxhciAyXHJcblxyXG4gR2l0SHViOiBodHRwczovL2dpdGh1Yi5jb20vYm9ybjJuZXQvbmcyQm9pbGVycGxhdGVcclxuXHJcbiBMaWNlbmNlOiBNSVRcclxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcblxyXG5pbXBvcnQge0NvbXBvbmVudCwgVmlld0NvbnRhaW5lclJlZiwgVmlld0VuY2Fwc3VsYXRpb259IGZyb20gJ2FuZ3VsYXIyL2NvcmUnO1xyXG5pbXBvcnQge0Jyb3dzZXJEb21BZGFwdGVyfSBmcm9tICdhbmd1bGFyMi9wbGF0Zm9ybS9icm93c2VyJztcclxuaW1wb3J0IHtDb25zdHN9IGZyb20gXCIuLi8uLi8uLi9zcmMvQ29udHNcIjtcclxuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tIFwicnhqcy9PYnNlcnZhYmxlXCI7XHJcbmltcG9ydCB7RGlnZ0xvYWRlcn0gZnJvbSBcIi4uLy4uLy4uL3NyYy9jb21wcy9kaWdnL0RpZ2dMb2FkZXJcIjtcclxuaW1wb3J0IHtPYnNlcnZlcn0gZnJvbSBcInJ4anMvT2JzZXJ2ZXJcIjtcclxuaW1wb3J0IHtJRGlnZ30gZnJvbSBcIi4vRGlnZ0xvYWRlclwiO1xyXG5pbXBvcnQge0NvbW1Ccm9rZXIsIElNZXNzYWdlfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvQ29tbUJyb2tlclwiO1xyXG5pbXBvcnQgJ3J4anMvYWRkL29ic2VydmFibGUvZnJvbSc7XHJcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvZG8nO1xyXG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL2RlYm91bmNlVGltZSc7XHJcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvZGlzdGluY3RVbnRpbENoYW5nZWQnO1xyXG5cclxuXHJcbmNvbnN0IERJR0dfSU5JVF9IRUlHSFQgPSAnNDAwcHgnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ0RpZ2cnLFxyXG4gICAgaW5wdXRzOiBbJ21vZGU6bW9kZSddLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uRW11bGF0ZWQsIC8vIHNvIHdlIGRvbid0IGJsZWVkIG91ciBzdHlsZXMgdG8gcmVzdCBvZiBkb21cclxuICAgIHByb3ZpZGVyczogW0RpZ2dMb2FkZXJdLFxyXG4gICAgc3R5bGVzOiBbYFxyXG4gICAgICAgIC5kaWdnQ29udGFpbmVyIHtcclxuICAgICAgICAgICAgb3ZlcmZsb3cteTogc2Nyb2xsO1xyXG4gICAgICAgICAgICBoZWlnaHQ6ICR7RElHR19JTklUX0hFSUdIVH07XHJcbiAgICAgICAgfTtcclxuICAgICAgICAubGFyZ2VJbWFnZSB7XHJcbiAgICAgICAgICAgbWF4LXdpZHRoOiAxMDA7XHJcbiAgICAgICAgICAgbWF4LWhlaWdodDogNjA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5zbWFsbEltYWdlIHtcclxuICAgICAgICAgICB3aWR0aDogNzA7XHJcbiAgICAgICAgICAgaGVpZ2h0OiA0MDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLmdyb3cgeyB0cmFuc2l0aW9uOiBhbGwgLjJzIGVhc2UtaW4tb3V0OyB9XHJcbiAgICAgICAgLmdyb3c6aG92ZXIgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7IG9wYWNpdHk6IDAuN31cclxuICAgIGBdLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgICAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImFwcEhlaWdodFwiPlxyXG4gICAgICAgICAgICAgPGZvcm0gKHN1Ym1pdCk9XCIkZXZlbnQucHJldmVudERlZmF1bHQoKTtcIj5cclxuICAgICAgICAgICAgICAgIDxici8+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaW5wdXQtZ3JvdXBcIj5cclxuICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiaW5wdXQtZ3JvdXAtYWRkb25cIiBpZD1cInN5bWJvbC1pbnB1dFwiPkRpZ2cgZmlsdGVyPC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiAoa2V5dXApPVwib25TZWFyY2goJGV2ZW50KVwiIHBsYWNlaG9sZGVyPVwicHJlc3MgW0VOVEVSXSBmb3IgdW5maWx0ZXJlZCByZXN1bHRcIj5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICA8L2Zvcm0+XHJcbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRpZ2dDb250YWluZXIgbGlzdFwiPlxyXG4gICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9XCJ0YWJsZSB0YWJsZS1zdHJpcGVkXCI+XHJcbiAgICAgICAgICAgICAgICAgIDx0Ym9keT5cclxuICAgICAgICAgICAgICAgICAgICA8dHIgKm5nRm9yPVwiI2RpZ2cgb2YgZGlnZ3NcIiBbbmdDbGFzc109XCJ7J2NvbC14cy00JzogdGlsZVN0eWxlLCAnY29sLWxnLTMnOiB0aWxlU3R5bGV9XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8dGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPVwiaW1nLXJlc3BvbnNpdmUgZ3Jvd1wiIFtuZ0NsYXNzXT1cInsnbGFyZ2VJbWFnZSc6IHRpbGVTdHlsZSwgJ3NtYWxsSW1hZ2UnOiAhdGlsZVN0eWxlfVwiIHNyYz1cInt7ZGlnZy5saW5rfX1cIi8+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57e2RpZ2cudGl0bGV9fTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgICAgICAgPC90Ym9keT5cclxuICAgICAgICAgICAgICAgIDwvdGFibGU+XHJcbiAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgYFxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIERpZ2cge1xyXG4gICAgcHJpdmF0ZSBtb2RlOnN0cmluZztcclxuICAgIHByaXZhdGUgdGlsZVN0eWxlOmJvb2xlYW47XHJcbiAgICBwcml2YXRlIGNoYW5uZWw6T2JzZXJ2YWJsZTxhbnlbXT47XHJcbiAgICBwcml2YXRlIHN0cmVhbTpPYnNlcnZlcjxhbnlbXT47XHJcbiAgICBwcml2YXRlIGRpZ2dzOklEaWdnW107XHJcbiAgICBwcml2YXRlIGVsOmFueTtcclxuICAgIHByaXZhdGUgdmlld0NvbnRhaW5lcjpWaWV3Q29udGFpbmVyUmVmO1xyXG4gICAgcHJpdmF0ZSBkb20gPSBuZXcgQnJvd3NlckRvbUFkYXB0ZXIoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbW1Ccm9rZXI6Q29tbUJyb2tlciwgZGlnZ0xvYWRlcjpEaWdnTG9hZGVyLCBwcml2YXRlIG1fY29tbUJyb2tlcjpDb21tQnJva2VyLCB2aWV3Q29udGFpbmVyOlZpZXdDb250YWluZXJSZWYpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VsZi5tb2RlID0gJ2xpc3QnO1xyXG4gICAgICAgIHRoaXMuZGlnZ3MgPSBbXTtcclxuICAgICAgICBzZWxmLnZpZXdDb250YWluZXIgPSB2aWV3Q29udGFpbmVyO1xyXG4gICAgICAgIHNlbGYuZWwgPSB2aWV3Q29udGFpbmVyLmVsZW1lbnQubmF0aXZlRWxlbWVudDtcclxuXHJcbiAgICAgICAgc2VsZi5jaGFubmVsID0gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG4gICAgICAgICAgICBzZWxmLnN0cmVhbSA9IG9ic2VydmVyO1xyXG4gICAgICAgIH0pLnNoYXJlKCk7XHJcblxyXG4gICAgICAgIC8vIGZvciBhIGNsZWFuZXIgYXBwcm9hY2ggdG8gT2JzZXJ2YWJsZSBlbmRwb2ludCBzZXJ2ZXIgY2FsbHMgc2VlIFdlYXRoZXIgY29tcG9uZW50XHJcbiAgICAgICAgc2VsZi5jaGFubmVsLmRlYm91bmNlVGltZSgxMDAwKS5kaXN0aW5jdFVudGlsQ2hhbmdlZCgpLnN1YnNjcmliZSgoZSk9PiB7XHJcbiAgICAgICAgICAgIHNlbGYuZGlnZ3MgPSBbXTtcclxuICAgICAgICAgICAgZGlnZ0xvYWRlci5sb2FkRGlnZ3MoZSwgc2VsZi5kaWdncylcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmxpc3RlbldpblJlc2l6ZSgpO1xyXG4gICAgICAgIHZhciBwcm9wVmlldyA9IHRoaXMuY29tbUJyb2tlci5nZXRTZXJ2aWNlKENvbnN0cy5TZXJ2aWNlcygpLlByb3BlcnRpZXMpO1xyXG4gICAgICAgIGlmIChwcm9wVmlldylcclxuICAgICAgICAgICAgcHJvcFZpZXcuc2V0UHJvcFZpZXcoJ0RpZ2cnKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG5nT25Jbml0KCl7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsaXN0ZW5XaW5SZXNpemUoKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYubV9jb21tQnJva2VyLm9uRXZlbnQoQ29uc3RzLkV2ZW50cygpLldJTl9TSVpFRCkuc3Vic2NyaWJlKChlOklNZXNzYWdlKT0+IHtcclxuICAgICAgICAgICAgc2VsZi5zZXRTaXplKGUubWVzc2FnZS5oZWlnaHQpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xyXG4gICAgICAgIHRoaXMudGlsZVN0eWxlID0gdGhpcy5tb2RlID09IFwidGlsZXNcIiA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB0aGlzLnNldFNpemUodGhpcy5tX2NvbW1Ccm9rZXIuZ2V0VmFsdWUoQ29uc3RzLlZhbHVlcygpLkFQUF9TSVpFKS5oZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0U2l6ZShoZWlnaHQpIHtcclxuICAgICAgICB2YXIgaDphbnkgPSBoZWlnaHQgLSAyMDA7XHJcbiAgICAgICAgLy92YXIgZWwgPSB0aGlzLmRvbS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRoaXMuZWwsIHRoaXMubW9kZSlbMF07XHJcbiAgICAgICAgdmFyIGVsID0gdGhpcy5kb20uZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSh0aGlzLmVsLCAnZGlnZ0NvbnRhaW5lcicpWzBdO1xyXG4gICAgICAgIHRoaXMuZG9tLnNldFN0eWxlKGVsLCAnaGVpZ2h0JywgaCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvblNlYXJjaChldmVudCkge1xyXG4gICAgICAgIHRoaXMuc3RyZWFtLm5leHQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
